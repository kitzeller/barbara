<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVG VM</title>
    <link href="https://fonts.googleapis.com/css?family=Nothing+You+Could+Do&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

    <link href="css/normalize.css" rel="stylesheet">
    <link href="css/skeleton.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
<!--Navbar-->
<div class="row" style="margin: 10px">
    <div class="column">
        <h1>
            Live Code a Graphics Language
        </h1>
    </div>
    <div class="column" style="margin-top: 10px">
        <button class="button-primary" onclick="window.location.href='index.html'">Editor</button>
        <button onclick="window.location.href='target_lang.html'">Target Lang</button>
        <button onclick="window.location.href='tutorial.html'">Tutorial</button>
        <button onclick="window.location.href='quilting.html'">Quilting</button>
    </div>
</div>

<div class="container-m10">
    <div class="row">
        <div class="column">
            <h2>Grammar</h2>
            <textarea id="grammar" style="width: 700px; height: 35%">
start "start" = term +
term "term" = body:(Text / list / word) _ { return body; }
list "list" = "(" _ body:term* ")" { return body; }

Text = "*" values:TextUntilTerminator "**" { return values.join(""); }
TextUntilTerminator = x:(&HaveTerminatorAhead .)* { return x.map(y => y[1]) }
HaveTerminatorAhead = . (!"**" .)* "**"

word "word" = circle / rect / polygon / path / text / pattern / gradient / image / color / rotate / radius / repeat / order / define / get / group / move / copy / all / duplicate / outline / flip / diag / size / animate_rotate / animate_move / animate_color / $[^() \t\n\r]+

circle = "circle" { return "@circle"; }
rect = "rect" { return "@rect"; }
polygon = "polygon" { return "@polygon"; }
path = "path" { return "@path"; }
text = "text" { return "@text"; }

pattern = "pattern" { return "@pattern"; }
gradient = "gradient" { return "@gradient"; }
image = "image" { return "@image"; }

color = "color" { return "@color"; }
radius = "radius" { return "@radius"; }
flip = "flip" { return "@flip"; }
order = "order" { return "@order"; }
repeat = "repeat" { return "@repeat"; }
diag = "diag" { return "@diag"; }
outline = "outline" { return "@outline"; }
rotate = "rotate" { return "@rotate"; }
move = "move" { return "@move"; }
size = "size" { return "@size"; }

all = "all" { return "@all"; }
group = "group" { return "@group"; }
copy = "copy" { return "@copy"; }
duplicate = "duplicate" { return "@duplicate"; }

define = "define" { return "@define"; }
get = "get" { return "@get"; }

animate_rotate = "animate-rotate" { return "@animate-rotate"; }
animate_move = "animate-move" { return "@animate-move"; }
animate_color = "animate-color" { return "@animate-color"; }

_ "whitespace" = [ \t\n\r]*

        </textarea>

            <h2>Input</h2>
            <textarea id="input" style="width: 700px; height: 20%">
(((0 0 50 50 rect) first-def define) first-def get blue color yellow 10 outline)
(((0 50 50 50 rect) sec-def define) sec-def get red color blue 10 outline)
(((50 0 50 50 rect) thir-def define) thir-def get yellow color green 10 outline)
(((50 50 50 50 rect) four-def define) four-def get green color red 10 outline)

(first-def sec-def thir-def four-def group five-def define)

(five-def get 50 50 size)

(five-def copy fivedef-cpy define fivedef-cpy get 50 50 move 180 rotate)
(five-def copy fivedef-cpy1 define fivedef-cpy1 get 0 50 move 270 rotate)
(five-def copy fivedef-cpy2 define fivedef-cpy2 get 50 0 move 90 rotate)

(five-def fivedef-cpy fivedef-cpy1 fivedef-cpy2 group bigone define)
(bigone get 50 50 size)

(bigone copy big-cpy define big-cpy get 50 50 move)
(bigone copy big-cpy1 define big-cpy1 get 0 50 move)
(bigone copy big-cpy2 define big-cpy2 get 50 0 move)

(all 50 50 size repeat)
(all duplicate 45 rotate)
        </textarea>

            <button onclick="makeParser()">Parse!</button>
            <button onclick="start()">Start</button>

            <h2>Output</h2>
            <textarea id="output" style="width: 700px; height: 100px"></textarea>

        </div>
        <div class="column">
            <h2>SVG Result</h2>
            <div id="drawing"></div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="peg-0.10.0.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.0.13/svg.js"></script>
<script src="vm.js"></script>

<script>
    /**
     ((100 100 100 100 rect) red color first define)

     ((0 0 100 100 rect) blue color second define)

     ((100 0 100 100 rect) green color third define)

     ((0 100 100 100 rect) yellow color fourth define)

     (first second third fourth group wow define)
     (wow get 90 rotate)
     (wow copy wowsec define wowsec get 200 200 move)

     (((100 100 100 100 rect) first-def define) first-def get 0 rotate blue color)
     (((0 100 100 100 rect) sec-def define) sec-def get 0 rotate red color)
     (((100 0 100 100 rect) thir-def define) thir-def get 0 rotate yellow color)
     (((0 0 100 100 rect) four-def define) four-def get 0 rotate green color)

     (first-def sec-def thir-def four-def group five-def define)
     (five-def copy fivedef-cpy define fivedef-cpy get 200 200 move)
     */
    function makeParser() {
        let grammer = $("#grammar").val();
        var parser = peg.generate(grammer);

        let input = $("#input").val().trim();
        let res = parser.parse(input);
        console.log(res);
        $("#output").val(JSON.stringify(res));
    }

    function start() {
        // start it
        let grammar = $("#grammar").val();
        var parser = peg.generate(grammar);
        let input = $("#input").val().trim();
        let res = parser.parse(input);
        let val = $("#output").val();

        if (!val) {
            alert("Please parse first!");
            return;
        }

        val = eval(val);

        window.seq.define("default", val);
    }
</script>


</body>
</html>
