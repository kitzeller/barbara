<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVG VM</title>
    <link href="https://fonts.googleapis.com/css?family=Nothing+You+Could+Do&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
<!--Navbar-->
<ul>
    <li><a class="active" href="index.html">Editor</a></li>
    <li><a href="target_lang.html">Target Language</a></li>
</ul>

<div class="container">
    <h1>
        Live Code a Language for SVG Manipulation
    </h1>

    <div class="row">
        <div class="column">
            <h2>Grammar</h2>
            <textarea id="grammar" style="width: 500px; height: 300px">
start "start" = term +
term "term" = body:(list / word) _ { return body; }
list "list" = "(" _ body:term* ")" { return body; }

word "word" = circle / rect / color / rotate / define / get / group / move / copy / outline / $[^() \t\n\r]+

circle = "circle" { return "@circle"; }
rect = "rect" { return "@rect"; }
color = "color" { return "@color"; }
outline = "outline" { return "@outline"; }
rotate = "rotate" { return "@rotate"; }
define = "define" { return "@define"; }
get = "get" { return "@get"; }
group = "group" { return "@group"; }
move = "move" { return "@move"; }
copy = "copy" { return "@copy"; }

_ "whitespace" = [ \t\n\r]*

        </textarea>

            <h2>Input</h2>
            <textarea id="input" style="width: 500px; height: 100px">
(((100 100 100 100 rect) first-def define) first-def get blue color)
(((0 100 100 100 rect) sec-def define) sec-def get red color)
(((100 0 100 100 rect) thir-def define) thir-def get yellow color)
(((0 0 100 100 rect) four-def define) four-def get green color)

(first-def sec-def thir-def four-def group five-def define)
(five-def copy fivedef-cpy define fivedef-cpy get 200 200 move 180 rotate)
(five-def copy fivedef-cpy1 define fivedef-cpy1 get 0 200 move 270 rotate)
(five-def copy fivedef-cpy2 define fivedef-cpy2 get 200 0 move 90 rotate)

(five-def fivedef-cpy fivedef-cpy1 fivedef-cpy2 group bigone define)
(bigone copy big-cpy define big-cpy get 400 400 move)
(bigone copy big-cpy1 define big-cpy1 get 0 400 move)
(bigone copy big-cpy2 define big-cpy2 get 400 0 move)
        </textarea>

            <button onclick="makeParser()">Parse!</button>

            <h2>Output</h2>
            <textarea id="output">

        </textarea>

            <button onclick="start()">Start</button>
        </div>
        <div class="column">
            <h2>SVG Result</h2>
            <div id="drawing"></div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="peg-0.10.0.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.0.13/svg.js"></script>
<script src="vm.js"></script>

<script>
    /**
     ((100 100 100 100 rect) red color first define)

     ((0 0 100 100 rect) blue color second define)

     ((100 0 100 100 rect) green color third define)

     ((0 100 100 100 rect) yellow color fourth define)

     (first second third fourth group wow define)
     (wow get 90 rotate)
     (wow copy wowsec define wowsec get 200 200 move)

     (((100 100 100 100 rect) first-def define) first-def get 0 rotate blue color)
     (((0 100 100 100 rect) sec-def define) sec-def get 0 rotate red color)
     (((100 0 100 100 rect) thir-def define) thir-def get 0 rotate yellow color)
     (((0 0 100 100 rect) four-def define) four-def get 0 rotate green color)

     (first-def sec-def thir-def four-def group five-def define)
     (five-def copy fivedef-cpy define fivedef-cpy get 200 200 move)
     */
    function makeParser() {
        let grammer = $("#grammar").val();
        var parser = peg.generate(grammer);

        let input = $("#input").val().trim();
        let res = parser.parse(input);
        console.log(res);
        $("#output").val(JSON.stringify(res));
    }

    function start() {
        // start it
        let grammer = $("#grammar").val();
        var parser = peg.generate(grammer);

        let input = $("#input").val().trim();
        let res = parser.parse(input);

        let val = $("#output").val();
        val = eval(val);

        window.seq.define("default", val);
    }
</script>


</body>
</html>
